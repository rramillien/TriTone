Opal.queue(function(Opal) {/* Generated by Opal 1.7.3 */
  var $klass = Opal.klass, $return_val = Opal.return_val, $defs = Opal.defs, $nesting = [], nil = Opal.nil;

  return (function($base, $super) {
    var self = $klass($base, $super, 'Atome');

    
    return $defs(self, '$mode', $return_val("tauri"))
  })($nesting[0], null)
});

Opal.modules["application/data_for_test"] = function(Opal) {/* Generated by Opal 1.7.3 */
  var $hash2 = Opal.hash2, $def = Opal.def, self = Opal.top, $nesting = [], $$ = Opal.$r($nesting), nil = Opal.nil, vie_object_format = nil, json_test = nil, hash_test = nil;

  Opal.add_stubs('to_json,parse,[]');
  
  
  $def(self, '$project_list', function $$project_list() {
    
    return $hash2(["i1", "i2", "i3", "i4"], {"i1": $hash2(["name", "data", "action"], {"name": "the song", "data": "item1", "action": "load_project"}), "i2": $hash2(["name", "data", "action"], {"name": "mon projet2", "data": "item2", "action": "load_project"}), "i3": $hash2(["name", "data", "action"], {"name": "autre projet", "data": "item3", "action": "load_project"}), "i4": $hash2(["name", "data", "action"], {"name": "my great song", "data": "item4", "action": "load_project"})})
  });
  
  $def(self, '$tool_list', function $$tool_list() {
    
    return $hash2(["t1", "t2", "t3", "t4", "t5", "t6", "t7", "t8", "t9", "t10", "t11", "t12"], {"t1": $hash2(["id", "action", "label", "type", "icon"], {"id": "t1", "action": "insert_module", "label": "saw", "type": "oscillator", "icon": "wave-saw"}), "t2": $hash2(["id", "action", "label", "type", "icon"], {"id": "t2", "action": "insert_module", "label": "sin", "type": "oscillator", "icon": "wave-sine"}), "t3": $hash2(["id", "action", "label", "type", "icon"], {"id": "t3", "action": "insert_module", "label": "square", "type": "oscillator", "icon": "wave-square"}), "t4": $hash2(["id", "action", "label", "type", "icon"], {"id": "t4", "action": "insert_module", "label": "triangle", "type": "oscillator", "icon": "wave-triangle"}), "t5": $hash2(["id", "action", "label", "type", "icon"], {"id": "t5", "action": "insert_module", "label": "audio in", "type": "io", "icon": "microphone"}), "t6": $hash2(["id", "action", "label", "type", "icon"], {"id": "t6", "action": "insert_module", "label": "audio out", "type": "io", "icon": "speaker"}), "t7": $hash2(["id", "action", "label", "type", "icon"], {"id": "t7", "action": "insert_module", "label": "midi in", "type": "io", "icon": "midi_in"}), "t8": $hash2(["id", "action", "label", "type", "icon"], {"id": "t8", "action": "insert_module", "label": "midi outdrdr", "type": "io", "icon": "midi_out"}), "t9": $hash2(["id", "action", "label", "type", "icon"], {"id": "t9", "action": "insert_module", "label": "sample", "type": "waveform", "icon": "waveform"}), "t10": $hash2(["id", "action", "label", "type", "icon"], {"id": "t10", "action": "insert_module", "label": "lowpass", "type": "filter", "icon": "low_pass"}), "t11": $hash2(["id", "action", "label", "type", "icon"], {"id": "t11", "action": "insert_module", "label": "highpass", "type": "filter", "icon": "high_pass"}), "t12": $hash2(["id", "action", "label", "type", "icon"], {"id": "t12", "action": "insert_module", "label": "bandpass", "type": "io", "icon": "band_pass"})})
  });
  vie_object_format = $hash2(["modules", "links"], {"modules": [$hash2(["id", "name", "type_id", "active", "input_slots", "output_slots", "position"], {"id": "90be7add-12fd-476e-a267-c4ea65cd0bad", "name": "Midi in", "type_id": "midi", "active": "true", "input_slots": [$hash2(["id", "name", "unit", "value"], {"id": "948151e4-93c5-428f-a2e9-01f560592a7d", "name": "active", "unit": "", "value": 1})], "output_slots": [$hash2(["id", "name", "unit"], {"id": "394119f0-886e-4fae-8ae7-d3b187266760", "name": "Midi out", "unit": ""})], "position": $hash2(["x", "y", "z"], {"x": 0, "y": 0, "z": 0})}), $hash2(["id", "name", "type_id", "active", "input_slots", "output_slots", "position"], {"id": "82a15e17-c93a-4db1-af8a-d79a32c5b590", "name": "Sin", "type_id": "oscillator", "active": "true", "input_slots": [$hash2(["id", "name", "unit", "value"], {"id": "f8ba775f-7a30-4728-99df-a6b6edf2666e", "name": "active", "unit": "", "value": 1}), $hash2(["id", "name", "unit", "value"], {"id": "002a39c1-e0eb-4ef3-9698-b8bc63faf467", "name": "freq", "unit": "khz", "value": 4.4})], "output_slots": [$hash2(["id", "name", "unit"], {"id": "3d3dd92b-5a61-43bd-b15b-7356224f0fbc", "name": "amplitude", "unit": "db"})], "position": $hash2(["x", "y", "z"], {"x": 1, "y": 0, "z": 0})}), $hash2(["id", "name", "type_id", "active", "input_slots", "output_slots", "position"], {"id": "6f214581-52ba-484a-a896-1e137305bdd5", "name": "mix", "type_id": "mixer", "active": "true", "input_slots": [$hash2(["id", "name", "unit", "value"], {"id": "fbf3a30a-f2a4-49ef-b56c-2830ad5f8917", "name": "active", "unit": "", "value": 1}), $hash2(["id", "name", "unit", "value"], {"id": "d1948f42-4260-4614-a3b8-2070b50c1e73", "name": "input1", "unit": "db", "value": []}), $hash2(["id", "name", "unit", "value"], {"id": "82399578-ec95-48f4-a909-d76e27571048", "name": "input2", "unit": "db", "value": []})], "output_slots": [$hash2(["id", "name", "unit"], {"id": "a1f1cde0-5432-4465-b2a0-d06f759515b0", "name": "mixout", "unit": "db"})], "position": $hash2(["x", "y", "z"], {"x": 2, "y": 0, "z": 0})}), $hash2(["id", "name", "type_id", "active", "input_slots", "output_slots", "position"], {"id": "bf35dea9-f94e-4b73-9cdc-4c57c20ad996", "name": "speak out", "type_id": "output", "active": "true", "input_slots": [$hash2(["id", "name", "unit", "value"], {"id": "fec34afa-a935-4892-949f-bb4ffc312468", "name": "active", "unit": "", "value": 1}), $hash2(["id", "name", "unit"], {"id": "4b0fc5c3-fc04-4122-905d-aeebc4e06099", "name": "input", "unit": "db"})], "output_slots": [], "position": $hash2(["x", "y", "z"], {"x": 3, "y": 0, "z": 0})})], "links": [$hash2(["id", "sourceComponentId", "sourceOutputSlotId", "targetComponentId", "targetInputSlotId", "active"], {"id": "dbde9cd8-462f-4f4a-80c6-cee0b0b9a5eb", "sourceComponentId": "90be7add-12fd-476e-a267-c4ea65cd0bad", "sourceOutputSlotId": "394119f0-886e-4fae-8ae7-d3b187266760", "targetComponentId": "82a15e17-c93a-4db1-af8a-d79a32c5b590", "targetInputSlotId": "002a39c1-e0eb-4ef3-9698-b8bc63faf467", "active": "true"}), $hash2(["id", "sourceComponentId", "sourceOutputSlotId", "targetComponentId", "targetInputSlotId", "active"], {"id": "0bf66202-50fe-4c82-81bd-7c828d1b4edb", "sourceComponentId": "82a15e17-c93a-4db1-af8a-d79a32c5b590", "sourceOutputSlotId": "3d3dd92b-5a61-43bd-b15b-7356224f0fbc", "targetComponentId": "6f214581-52ba-484a-a896-1e137305bdd5", "targetInputSlotId": "d1948f42-4260-4614-a3b8-2070b50c1e73", "active": "true"}), $hash2(["id", "sourceComponentId", "sourceOutputSlotId", "targetComponentId", "targetInputSlotId", "active"], {"id": "929faf01-6320-4273-8557-819f414c9d3a", "sourceComponentId": "6f214581-52ba-484a-a896-1e137305bdd5", "sourceOutputSlotId": "a1f1cde0-5432-4465-b2a0-d06f759515b0", "targetComponentId": "bf35dea9-f94e-4b73-9cdc-4c57c20ad996", "targetInputSlotId": "4b0fc5c3-fc04-4122-905d-aeebc4e06099", "active": "true"})]});
  json_test = vie_object_format.$to_json();
  hash_test = $$('JSON').$parse(json_test);
  return $def(self, '$get_icon', function $$get_icon(icon_name) {
    var load = nil, clear = nil, settings = nil, edition = nil, select = nil, group = nil, copy = nil, paste = nil, undo = nil, icons = nil;

    
    load = "<svg version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\"   xml:space=\"preserve\" viewBox=\"0 0 1024 1024\">\n" + "    <path id=\"folderCanvas-p1\" stroke=\"none\" fill=\"rgb(170, 170, 170)\" d=\"M 848.62,922 L 186.38,922 C 125.42,922 76,871.39 76,808.99 L 76,243.87 C 76,181.5 125.42,130.89 186.38,130.89 L 344.58,130.89 344.05,130.89 C 386.9,130.89 425.87,155.91 443.98,195.05 L 466.73,243.89 848.62,243.89 C 909.58,243.89 959,294.5 959,356.92 L 959,808.99 C 959,871.39 909.58,922 848.62,922 Z M 149.58,461.65 L 149.58,808.99 C 149.58,829.79 166.07,846.65 186.38,846.65 L 848.62,846.65 C 868.93,846.65 885.42,829.79 885.42,808.99 L 885.42,461.65 149.58,461.65 Z M 149.58,386.29 L 885.42,386.29 885.42,356.92 C 885.42,336.11 868.93,319.25 848.63,319.25 L 443.92,319.25 444.15,319.25 C 429.87,319.25 416.89,310.91 410.85,297.87 L 378.06,227.7 378.02,227.62 C 371.99,214.58 359,206.24 344.72,206.24 L 186.38,206.24 C 166.07,206.24 149.58,223.1 149.58,243.89 L 149.58,386.29 Z M 149.58,386.29\" />\n" + "</svg>\n" + "\n";
    clear = "<svg class=\"svg-icon\" style=\"width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;\"\n" + "     viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\">\n" + "  <path id=\"path1\" d=\"M772.096 368.64H654.336V153.6c0-78.848-63.488-142.336-142.336-142.336S369.664 74.752 369.664 153.6v215.04H251.904c-94.208 0-171.008 76.8-171.008 171.008v59.392c0 53.248 44.032 97.28 97.28 97.28h4.096l-51.2 121.856c-18.432 43.008-13.312 92.16 12.288 132.096 25.6 38.912 69.632 62.464 116.736 62.464h501.76c48.128 0 92.16-23.552 117.76-64.512 25.6-39.936 29.696-90.112 9.216-133.12L833.536 696.32h12.288c53.248 0 97.28-44.032 97.28-97.28v-59.392c0-95.232-76.8-171.008-171.008-171.008zM451.584 153.6c0-32.768 26.624-60.416 60.416-60.416 32.768 0 60.416 26.624 60.416 60.416v215.04H451.584V153.6zM808.96 904.192c-11.264 16.384-28.672 26.624-49.152 26.624h-501.76c-19.456 0-36.864-9.216-48.128-25.6s-12.288-35.84-5.12-54.272l63.488-150.528h12.288v124.928c0 22.528 18.432 40.96 40.96 40.96s40.96-18.432 40.96-40.96v-122.88-2.048h40.96v124.928c0 22.528 18.432 40.96 40.96 40.96s40.96-18.432 40.96-40.96v-122.88-3.072h40.96v125.952c0 22.528 18.432 40.96 40.96 40.96s40.96-18.432 40.96-40.96v-122.88-4.096h40.96v126.976c0 22.528 18.432 40.96 40.96 40.96s40.96-18.432 40.96-40.96v-122.88-5.12h14.336L815.104 849.92c6.144 16.384 5.12 36.864-6.144 54.272z m52.224-306.176c0 8.192-7.168 15.36-15.36 15.36H178.176c-8.192 0-15.36-7.168-15.36-15.36v-59.392c0-49.152 39.936-89.088 89.088-89.088h520.192c49.152 0 89.088 39.936 89.088 89.088v59.392z\"\n" + "        fill=\"#333C4F\"/>\n" + "</svg>\n";
    settings = "<?xml version=\"1.0\" encoding=\"UTF-8\" standalone=\"no\"?>\n" + "<!DOCTYPE svg PUBLIC \"-//W3C//DTD SVG 1.1//EN\" \"http://www.w3.org/Graphics/SVG/1.1/DTD/svg11.dtd\">\n" + "<svg width=\"100%\" height=\"100%\" viewBox=\"0 0 800 800\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\" xmlns:xlink=\"http://www.w3.org/1999/xlink\" xml:space=\"preserve\" xmlns:serif=\"http://www.serif.com/\" style=\"fill-rule:evenodd;clip-rule:evenodd;stroke-linecap:round;stroke-linejoin:round;stroke-miterlimit:10;\">\n" + "    <path id=\"settingsCanvas-settingsbezier\" d=\"M464.37,112.09C477.93,150.24 521.5,168.28 558.07,150.9C616.12,123.31 676.69,183.88 649.1,241.93C631.72,278.5 649.76,322.07 687.91,335.63C748.48,357.17 748.48,442.83 687.91,464.37C649.76,477.93 631.72,521.5 649.1,558.07C676.69,616.12 616.12,676.69 558.07,649.1C521.5,631.72 477.93,649.76 464.37,687.91C442.83,748.48 357.17,748.48 335.63,687.91C322.07,649.76 278.5,631.72 241.93,649.1C183.88,676.69 123.31,616.12 150.9,558.07C168.28,521.5 150.24,477.93 112.09,464.37C51.52,442.83 51.52,357.17 112.09,335.63C150.24,322.07 168.28,278.5 150.9,241.93C123.31,183.88 183.88,123.31 241.93,150.9C278.5,168.28 322.07,150.24 335.63,112.09C357.17,51.52 442.83,51.52 464.37,112.09ZM400,300C390.8,300 381.9,301.24 373.44,303.57C331.1,315.2 300,353.97 300,400C300,455.23 344.77,500 400,500C455.23,500 500,455.23 500,400C500,344.77 455.23,300 400,300Z\" style=\"fill:none;fill-rule:nonzero;stroke-width:60px;\"/>\n" + "</svg>\n" + "\n";
    edition = "<svg class=\"svg-icon\" style=\"width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;\"\n" + "     viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\">\n" + "  <path id=\"p1\" d=\"M257.7 752c2 0 4-0.2 6-0.5L431.9 722c2-0.4 3.9-1.3 5.3-2.8l423.9-423.9c3.9-3.9 3.9-10.2 0-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2c-1.9 11.1 1.5 21.9 9.4 29.8 6.6 6.4 14.9 9.9 23.8 9.9z m67.4-174.4L687.8 215l73.3 73.3-362.7 362.6-88.9 15.7 15.6-89zM880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32z\"/>\n" + "</svg>\n";
    select = "<svg class=\"svg-icon\" style=\"width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;\"\n" + "     viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\">\n" + "  <path id=\"path\" d=\"M281.6 137.813333a128 128 0 0 0-128 128v469.333334a128 128 0 0 0 128 128h213.333333a42.666667 42.666667 0 1 0 0-85.333334h-213.333333a42.666667 42.666667 0 0 1-42.666667-42.666666v-469.333334a42.666667 42.666667 0 0 1 42.666667-42.666666h469.333333a42.666667 42.666667 0 0 1 42.666667 42.666666v213.333334a42.666667 42.666667 0 1 0 85.333333 0v-213.333334a128 128 0 0 0-128-128h-469.333333z m294.613333 380.544l42.154667 365.184a21.333333 21.333333 0 0 0 38.357333 10.24l80.213334-108.629333 114.048 169.941333a42.666667 42.666667 0 1 0 70.826666-47.573333l-114.048-169.941333 124.416-36.693334a21.333333 21.333333 0 0 0 3.498667-39.552l-328.746667-164.522666a21.333333 21.333333 0 0 0-30.72 21.546666z\"/>\n" + "</svg>\n";
    group = "<svg width=\"24\" height=\"24\" fill=\"none\" viewBox=\"0 0 24 24\" xmlns=\"http://www.w3.org/2000/svg\">\n" + "  <path id=\"p1\" d=\"M5 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4ZM19 7a2 2 0 1 0 0-4 2 2 0 0 0 0 4ZM21 19a2 2 0 1 1-4 0 2 2 0 0 1 4 0ZM5 21a2 2 0 1 0 0-4 2 2 0 0 0 0 4Z\"\n" + "        fill=\"#212121\"/>\n" + "  <path id=\"p2\" d=\"M7.83 6a2.995 2.995 0 0 0 0-2h4.67A2.5 2.5 0 0 1 15 6.5V9h2.5a2.5 2.5 0 0 1 2.5 2.5v4.67a2.997 2.997 0 0 0-2 0V11.5a.5.5 0 0 0-.5-.5H15v1.5a2.5 2.5 0 0 1-2.5 2.5H11v2.5a.5.5 0 0 0 .5.5h4.67a2.997 2.997 0 0 0 0 2H11.5A2.5 2.5 0 0 1 9 17.5V15H6.5A2.5 2.5 0 0 1 4 12.5V7.83a2.995 2.995 0 0 0 2 0v4.67a.5.5 0 0 0 .5.5H9v-1.5A2.5 2.5 0 0 1 11.5 9H13V6.5a.5.5 0 0 0-.5-.5H7.83ZM13 12.5V11h-1.5a.5.5 0 0 0-.5.5V13h1.5a.5.5 0 0 0 .5-.5Z\"\n" + "        fill=\"#212121\"/>\n" + "</svg>\n";
    copy = "<svg class=\"svg-icon\" style=\"width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;\"\n" + "     viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\">\n" + "  <path id=\"p1\" d=\"M672 832 224 832c-52.928 0-96-43.072-96-96L128 160c0-52.928 43.072-96 96-96l448 0c52.928 0 96 43.072 96 96l0 576C768 788.928 724.928 832 672 832zM224 128C206.368 128 192 142.368 192 160l0 576c0 17.664 14.368 32 32 32l448 0c17.664 0 32-14.336 32-32L704 160c0-17.632-14.336-32-32-32L224 128z\"/>\n" + "  <path id=\"p2\" d=\"M800 960 320 960c-17.664 0-32-14.304-32-32s14.336-32 32-32l480 0c17.664 0 32-14.336 32-32L832 256c0-17.664 14.304-32 32-32s32 14.336 32 32l0 608C896 916.928 852.928 960 800 960z\"/>\n" + "  <path id=\"p3\" d=\"M544 320 288 320c-17.664 0-32-14.336-32-32s14.336-32 32-32l256 0c17.696 0 32 14.336 32 32S561.696 320 544 320z\"/>\n" + "  <path id=\"p4\" d=\"M608 480 288.032 480c-17.664 0-32-14.336-32-32s14.336-32 32-32L608 416c17.696 0 32 14.336 32 32S625.696 480 608 480z\"/>\n" + "  <path id=\"p5\" d=\"M608 640 288 640c-17.664 0-32-14.304-32-32s14.336-32 32-32l320 0c17.696 0 32 14.304 32 32S625.696 640 608 640z\"/>\n" + "</svg>\n";
    paste = "<svg class=\"svg-icon\" style=\"width: 1em; height: 1em;vertical-align: middle;fill: currentColor;overflow: hidden;\"\n" + "     viewBox=\"0 0 1024 1024\" version=\"1.1\" xmlns=\"http://www.w3.org/2000/svg\">\n" + "  <path id=\"path1\" d=\"M810.666667 85.333333l-178.56 0c-17.493333-49.493333-64.426667-85.333333-120.106667-85.333333s-102.613333 35.84-120.106667 85.333333l-178.56 0c-47.146667 0-85.333333 38.186667-85.333333 85.333333l0 682.666667c0 47.146667 38.186667 85.333333 85.333333 85.333333l597.333333 0c47.146667 0 85.333333-38.186667 85.333333-85.333333l0-682.666667c0-47.146667-38.186667-85.333333-85.333333-85.333333zM512 85.333333c23.466667 0 42.666667 18.986667 42.666667 42.666667s-19.2 42.666667-42.666667 42.666667-42.666667-18.986667-42.666667-42.666667 19.2-42.666667 42.666667-42.666667zM810.666667 853.333333l-597.333333 0 0-682.666667 85.333333 0 0 128 426.666667 0 0-128 85.333333 0 0 682.666667z\"/>\n" + "</svg>\n";
    undo = "<svg xmlns=\"http://www.w3.org/2000/svg\"\n" + "     viewBox=\"0 0 512 512\"><!-- Font Awesome Free 5.15.4 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) -->\n" + "  <path id=\"p\" d=\"M255.545 8c-66.269.119-126.438 26.233-170.86 68.685L48.971 40.971C33.851 25.851 8 36.559 8 57.941V192c0 13.255 10.745 24 24 24h134.059c21.382 0 32.09-25.851 16.971-40.971l-41.75-41.75c30.864-28.899 70.801-44.907 113.23-45.273 92.398-.798 170.283 73.977 169.484 169.442C423.236 348.009 349.816 424 256 424c-41.127 0-79.997-14.678-110.63-41.556-4.743-4.161-11.906-3.908-16.368.553L89.34 422.659c-4.872 4.872-4.631 12.815.482 17.433C133.798 479.813 192.074 504 256 504c136.966 0 247.999-111.033 248-247.998C504.001 119.193 392.354 7.755 255.545 8z\"/>\n" + "</svg>\n";
    icons = $hash2(["load", "clear", "settings", "edition", "select", "group", "copy", "paste", "undo"], {"load": load, "clear": clear, "settings": settings, "edition": edition, "select": select, "group": group, "copy": copy, "paste": paste, "undo": undo});
    return icons['$[]'](icon_name);
  });
};

Opal.modules["application/experimental_api"] = function(Opal) {/* Generated by Opal 1.7.3 */
  var $slice = Opal.slice, $def = Opal.def, self = Opal.top, nil = Opal.nil;

  
  
  $def(self, '$svg_fetch', function $$svg_fetch(svg_name, $a, $b) {
    var $post_args, svg_color, target;

    
    $post_args = $slice(arguments, 1);
    
    if ($post_args.length > 1) svg_color = $post_args.shift();if (svg_color == null) svg_color = "lightgray";
    
    target = $post_args.shift();if (target == null) target = nil;
    
 fetch("./medias/images/icons/" +svg_name +".svg")
    .then(response => response.text())
   .then(svgText => {
        let svgContainer = document.getElementById(target);
        let parser = new DOMParser();
        let svgDoc = parser.parseFromString(svgText, "image/svg+xml");
        let importedSVG = svgDoc.getElementsByTagName("svg")[0];
        importedSVG.style.width =  "100%";
        importedSVG.style.height =  "100%";
        let elements = importedSVG.getElementsByTagName("path");
        Array.from(elements).forEach(el => {
            el.setAttribute("fill", svg_color);
            el.setAttribute("stroke", svg_color);
        });
        svgContainer.appendChild(importedSVG);
    });

;
  }, -3);
  return $def(self, '$display_svg', function $$display_svg(svg_content, $a, $b) {
    var $post_args, svg_color, target;

    
    $post_args = $slice(arguments, 1);
    
    if ($post_args.length > 1) svg_color = $post_args.shift();if (svg_color == null) svg_color = "lightgray";
    
    target = $post_args.shift();if (target == null) target = nil;
    
       let svgContainer = document.getElementById(target);
        let parser = new DOMParser();
        let svgDoc = parser.parseFromString(svg_content, "image/svg+xml");
        let importedSVG = svgDoc.getElementsByTagName("svg")[0];
        importedSVG.style.width =  "100%";
        importedSVG.style.height =  "100%";
        let elements = importedSVG.getElementsByTagName("path");
        Array.from(elements).forEach(el => {
            el.setAttribute("fill", svg_color);
            el.setAttribute("stroke", svg_color);
        });
        svgContainer.appendChild(importedSVG);
;
  }, -3);
};

Opal.modules["application/version"] = function(Opal) {/* Generated by Opal 1.7.3 */
  var self = Opal.top, nil = Opal.nil;

  Opal.add_stubs('puts');
  
  self.$puts("vie version: 0.001");
  return self.$puts("v-UIe version: 0.005\n");
};

Opal.modules["application/styles"] = function(Opal) {/* Generated by Opal 1.7.3 */
  var $hash2 = Opal.hash2, $rb_divide = Opal.rb_divide, $rb_plus = Opal.rb_plus, $rb_times = Opal.rb_times, $rb_minus = Opal.rb_minus, $def = Opal.def, self = Opal.top, nil = Opal.nil;

  Opal.add_stubs('/,+,*,-,color,[],vie_styles,shadow,attached,grab');
  
  
  $def(self, '$vie_styles', function $$vie_styles() {
    var action_height = nil, toolbox_with = nil, inspector_with = nil, navigation_height = nil, margin = nil, smooth = nil;

    
    action_height = 39;
    toolbox_with = 52;
    inspector_with = 120;
    navigation_height = 30;
    margin = 9;
    smooth = 3;
    return $hash2(["margin", "toolbox_with", "inspector_with", "navigation_height", "text_color", "list_style", "back_color", "title", "toolbox_color", "center_color", "action_color", "inspector_color", "active_color", "inactive_color", "dark_color", "invisible_color", "darker_color", "cell_color", "cell_connected", "cell_shadow", "toolbox_style", "inspector_style", "action_style", "filer", "support_style", "center_style", "matrix_style"], {"margin": margin, "toolbox_with": 60, "inspector_with": inspector_with, "navigation_height": 30, "text_color": $hash2(["red", "green", "blue", "id"], {"red": 0.6, "green": 0.6, "blue": 0.6, "id": "text_color"}), "list_style": $hash2(["visual", "width", "left", "attached"], {"visual": $hash2(["size"], {"size": 15}), "width": 99, "left": 9, "attached": ["inactive_color"]}), "back_color": $hash2(["red", "green", "blue", "id"], {"red": 0.1, "green": 0.1, "blue": 0.1, "id": "back_color"}), "title": $hash2(["id", "visual", "width", "left", "center", "top", "attached"], {"id": "title", "visual": $hash2(["size"], {"size": 21}), "width": "auto", "left": 25, "center": "horizontal", "top": 9, "attached": ["inactive_color"]}), "toolbox_color": $hash2(["red", "green", "blue", "id"], {"red": 0.1, "green": 0.1, "blue": 0.1, "id": "toolbox_color"}), "center_color": $hash2(["red", "green", "blue", "alpha", "id"], {"red": 0, "green": 0, "blue": 0, "alpha": 0, "id": "center_color"}), "action_color": $hash2(["red", "green", "blue", "alpha", "id"], {"red": 0, "green": 0, "blue": 0, "alpha": 0, "id": "action_color"}), "inspector_color": $hash2(["red", "green", "blue", "id"], {"red": 0.12, "green": 0.12, "blue": 0.12, "id": "inspector_color"}), "active_color": $hash2(["red", "green", "blue", "id"], {"red": 0.8, "green": 0.36, "blue": 0.07, "id": "active_color"}), "inactive_color": $hash2(["red", "green", "blue", "id"], {"red": 0.3, "green": 0.3, "blue": 0.3, "id": "inactive_color"}), "dark_color": $hash2(["red", "green", "blue", "id"], {"red": 0.127, "green": 0.127, "blue": 0.127, "id": "dark_color"}), "invisible_color": $hash2(["red", "green", "blue", "alpha", "id"], {"red": 0, "green": 0, "blue": 0, "alpha": 0, "id": "invisible_color"}), "darker_color": $hash2(["red", "green", "blue", "id"], {"red": 0.127, "green": 0.127, "blue": 0.127, "id": "darker_color"}), "cell_color": $hash2(["red", "green", "blue", "id"], {"red": 0.17, "green": 0.15, "blue": 0.13, "id": "cell_color"}), "cell_connected": $hash2(["red", "green", "blue", "id"], {"red": $rb_divide(154, 255), "green": $rb_divide(205, 255), "blue": $rb_divide(50, 255), "id": "cell_connected"}), "cell_shadow": $hash2(["blur", "left", "top", "id", "red", "green", "blue", "alpha"], {"blur": 9, "left": 3, "top": 3, "id": "cell_shadow", "red": 0, "green": 0, "blue": 0, "alpha": 0.3}), "toolbox_style": $hash2(["id", "overflow", "left", "top", "smooth", "width", "bottom", "height", "attached"], {"id": "toolbox", "overflow": "hidden", "left": margin, "top": $rb_plus(action_height, margin), "smooth": smooth, "width": toolbox_with, "bottom": 30, "height": 420, "attached": ["toolbox_color"]}), "inspector_style": $hash2(["id", "left", "top", "smooth", "width", "bottom", "height", "overflow", "attached"], {"id": "inspector", "left": $rb_plus(toolbox_with, $rb_times(margin, 2)), "top": $rb_plus(action_height, margin), "smooth": smooth, "width": inspector_with, "bottom": 0, "height": 420, "overflow": "auto", "attached": ["cell_shadow", "inspector_color"]}), "action_style": $hash2(["id", "left", "top", "width", "right", "height", "attached"], {"id": "action", "left": toolbox_with, "top": 0, "width": "auto", "right": 0, "height": action_height, "attached": ["action_color"]}), "filer": $hash2(["id", "top", "bottom", "left", "width", "overflow", "height", "attached", "smooth"], {"id": "filer", "top": 12, "bottom": 36, "left": 6, "width": $rb_minus(inspector_with, 12), "overflow": "auto", "height": "auto", "attached": ["darker_color"], "smooth": 6}), "support_style": $hash2(["left", "width", "height", "attached"], {"left": 6, "width": 23, "height": 23, "attached": ["invisible_color"]}), "center_style": $hash2(["id", "left", "bottom", "top", "right", "width", "height", "attached"], {"id": "center", "left": $rb_plus($rb_plus(toolbox_with, inspector_with), $rb_times(margin, 3)), "bottom": navigation_height, "top": action_height, "right": 0, "width": "auto", "height": "auto", "attached": ["center_color"]}), "matrix_style": $hash2([], {})});
  });
  self.$color(self.$vie_styles()['$[]']("back_color"));
  self.$color(self.$vie_styles()['$[]']("toolbox_color"));
  self.$color(self.$vie_styles()['$[]']("action_color"));
  self.$color(self.$vie_styles()['$[]']("inspector_color"));
  self.$color(self.$vie_styles()['$[]']("center_color"));
  self.$color(self.$vie_styles()['$[]']("darker_color"));
  self.$color(self.$vie_styles()['$[]']("dark_color"));
  self.$color(self.$vie_styles()['$[]']("text_color"));
  self.$color(self.$vie_styles()['$[]']("active_color"));
  self.$color(self.$vie_styles()['$[]']("inactive_color"));
  self.$color(self.$vie_styles()['$[]']("cell_connected"));
  self.$color(self.$vie_styles()['$[]']("invisible_color"));
  self.$shadow(self.$vie_styles()['$[]']("cell_shadow"));
  return self.$grab("view").$attached("back_color");
};

Opal.queue(function(Opal) {/* Generated by Opal 1.7.3 */
  var $def = Opal.def, $send = Opal.send, $hash2 = Opal.hash2, $eqeq = Opal.eqeq, $truthy = Opal.truthy, $rb_plus = Opal.rb_plus, $rb_times = Opal.rb_times, $to_ary = Opal.to_ary, $rb_divide = Opal.rb_divide, self = Opal.top, nil = Opal.nil, default_project_name = nil, logo_color = nil, logo = nil, module_box = nil;

  Opal.add_stubs('alert,to_json,each,text,grab,==,length,send,controller_listener,require,element,box,[],vie_styles,display_svg,merge,matrix,detached,width,right,each_with_index,materials,touch,cell,puts,data,[]=,include?,id,attached,<<,clear_zone,vivify,wait,create_matrix,set_title,+,*,get_icon,fill_toolzone,delete,top,remove_active,controller_sender,list,each_value,tool_list,svg_fetch,drag,/,height,action_get_modules');
  
  
  $def(self, '$controller_sender', function $$controller_sender(params) {
    var self = this, json_msg = nil;

    
    self.$alert(params);
    json_msg = params.$to_json();
    
 var json_msg = JSON.parse(json_msg);
    if (window.webkit) {
console.log('=====>'+typeof json_msg);
        //window.webkit.messageHandlers.toggleMessageHandler.postMessage(json_msg);
    } else {
       window.chrome.webview.postMessage(json_msg);
    }
;
  });
  
  $def(self, '$get_projects_callback', function $$get_projects_callback(body) {
    var self = this;

    
    $send(body, 'each', [], function $$1(project){var self = $$1.$$s == null ? this : $$1.$$s, content = nil;

      
      if (project == null) project = nil;
      content = "project is : " + (project["name"]) + "\nid:  " + (project["id"]) + "\ndescription:  " + (project["description"]);
      return self.$grab("inspector").$text($hash2(["data", "top", "visual"], {"data": content, "top": 60, "visual": $hash2(["size"], {"size": 12})}));}, {$$s: self});
    if (!$eqeq(body.$length(), 0)) {
      return nil
    };
    return self.$grab("inspector").$text($hash2(["data", "top", "visual"], {"data": "no project", "top": 60, "visual": $hash2(["size"], {"size": 12})}));
  });
  
  $def(self, '$new_project_callback', function $$new_project_callback(body) {
    var self = this, content = nil;

    
    content = "new project is : " + (body["name"]) + "\nid:  " + (body["id"]);
    return self.$grab("inspector").$text($hash2(["data", "top", "visual"], {"data": content, "top": 60, "visual": $hash2(["size"], {"size": 12})}));
  });
  
  $def(self, '$response_listener', function $$response_listener(hashed_msg) {
    var self = this, js_action = nil, js_body = nil;

    
    js_action = hashed_msg["action"];
    js_body = hashed_msg["body"];
    return self.$send(js_action, js_body);
  });
  
  $def(self, '$controller_listener', function $$controller_listener() {
    
    
  if (window.webkit) {
// write code here:
    } else {
     window.chrome.webview.addEventListener('message', arg => {
//var response= Opal.hash(arg.data)
Opal.Object.$response_listener(arg.data)
    // console.log("data received from the controller : "+arg.data);
       });
    }

  });
  self.$controller_listener();
  self.$require("application/data_for_test");
  self.$require("application/experimental_api");
  self.$require("application/version");
  self.$require("application/styles");
  default_project_name = "untiltled";
  self.$element($hash2(["id", "data"], {"id": "connection", "data": [1, 3]}));
  self.$element($hash2(["id", "data"], {"id": "current_matrix", "data": ["0_0_0"]}));
  self.$element($hash2(["id", "data"], {"id": "selected", "data": []}));
  self.$element($hash2(["id", "data"], {"id": "context", "data": "default"}));
  self.$element($hash2(["id", "data"], {"id": "current_project", "data": default_project_name}));
  self.$element($hash2(["id", "data"], {"id": "links", "data": $hash2([], {})}));
  self.$box(self.$vie_styles()['$[]']("center_style"));
  self.$box(self.$vie_styles()['$[]']("action_style"));
  self.$box(self.$vie_styles()['$[]']("toolbox_style"));
  self.$box(self.$vie_styles()['$[]']("inspector_style"));
  logo_color = "rgba(99, 255, 99, 0.3)";
  self.$grab("action").$box($hash2(["id", "width", "height", "left", "top", "right", "attached"], {"id": "logo_support", "width": 33, "height": 33, "left": "auto", "top": 7, "right": 15, "attached": "invisible_color"}));
  logo = "<svg  xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 256 256\" >\n" + "<path id=\"vieCanvas-bezier\" stroke=\"rgb(0, 0, 0)\" stroke-width=\"1\" stroke-miterlimit=\"10\" fill=\"rgb(255, 0, 0)\" d=\"M 73.04,26.41 C 50.57,12.14 15.77,53.39 15.81,85.33 15.83,107.68 23.49,124.45 35.37,139.38 97.06,203.55 73.1,232.52 109.61,231.71 134.09,231.16 181.15,134.57 220.5,138.31 232.63,123.3 240.52,106.7 240.5,85.07 240.5,84.51 240.49,83.95 240.47,83.4 211.52,29.92 146.74,182.8 114.45,179.38 69.64,174.65 90.68,37.61 73.04,26.41 Z M 172.32,76.13 C 172.32,94.63 157.34,109.64 138.85,109.64 120.36,109.64 105.37,94.63 105.37,76.13 105.37,57.62 120.36,42.62 138.85,42.62 157.34,42.62 172.32,57.62 172.32,76.13 Z M 172.32,76.13\" />\n" + "</svg>\n";
  self.$display_svg(logo, logo_color, "logo_support");
  self.$grab("action").$text(self.$vie_styles()['$[]']("title").$merge($hash2(["data"], {"data": default_project_name})));
  
  $def(self, '$create_matrix', function $$create_matrix(id) {
    var self = this, center = nil, modules = nil, inspector = nil;

    
    center = self.$grab("center");
    modules = center.$matrix($hash2(["id", "top", "left", "smooth", "columns", "rows", "width", "height", "color", "cells"], {"id": "vm_" + (id), "top": 0, "left": 0, "smooth": 0, "columns": $hash2(["count"], {"count": 8}), "rows": $hash2(["count"], {"count": 8}), "width": 440, "height": 440, "color": $hash2(["alpha"], {"alpha": 0}), "cells": $hash2(["particles"], {"particles": $hash2(["margin", "smooth", "color", "shadow"], {"margin": 9, "smooth": 3, "color": self.$vie_styles()['$[]']("cell_color"), "shadow": self.$vie_styles()['$[]']("cell_shadow")})})}));
    center.$detached("cell_color");
    center.$detached("cell_shadow");
    modules.$width("auto");
    modules.$right(0);
    inspector = self.$grab("inspector");
    return $send(modules.$materials(), 'each_with_index', [], function $$2(_module_found, index){var self = $$2.$$s == null ? this : $$2.$$s;

      
      if (_module_found == null) _module_found = nil;
      if (index == null) index = nil;
      $send(modules.$cell(index), 'touch', ["down"], function $$3(){var $a, self = $$3.$$s == null ? this : $$3.$$s;

        
        self.$puts("down context is: " + (self.$grab("context").$data()));
        return ($a = [0, index], $send(self.$grab("connection").$data(), '[]=', $a), $a[$a.length - 1]);}, {$$s: self});
      $send(modules.$cell(index), 'touch', ["long"], function $$4(){var self = $$4.$$s == null ? this : $$4.$$s;

        
        self.$puts("up context is: " + (self.$grab("context").$data()));
        if ($truthy(self.$grab("selected").$data()['$include?'](self.$id()))) {
          
          $send(self.$grab("selected").$data(), 'each', [], function $$5(cell_id){var self = $$5.$$s == null ? this : $$5.$$s, selected_cell = nil;

            
            if (cell_id == null) cell_id = nil;
            selected_cell = self.$grab(cell_id);
            selected_cell.$attached(["cell_color"]);
            return selected_cell.$detached("active_color");}, {$$s: self});
          return self.$grab("selected").$data([]);
        } else {
          
          self.$grab("selected").$data()['$<<'](self.$id());
          self.$attached(["active_color"]);
          return self.$detached("cell_color");
        };}, {$$s: self});
      return $send(modules.$cell(index), 'touch', ["up"], function $$6(){var self = $$6.$$s == null ? this : $$6.$$s, source_cell = nil, target_cell = nil, new_connection = nil;

        
        self.$grab("connection").$data()['$[]='](1, index);
        source_cell = self.$grab("connection").$data()['$[]'](0);
        target_cell = self.$grab("connection").$data()['$[]'](1);
        if ($eqeq(source_cell, target_cell)) {
          return nil
        } else {
          
          self.$clear_zone(inspector);
          new_connection = self.$grab("connection").$data();
          self.$vivify($hash2(["connect"], {"connect": "TODO :add matrix _id  " + (new_connection)}));
          self.$grab("links").$data()['$[]=']("toto", "poilu");
          self.$grab("connection").$data()['$<<']("titi");
          inspector.$text($hash2(["data"], {"data": new_connection}));
          modules.$cell(source_cell).$detached("cell_color");
          modules.$cell(target_cell).$detached("cell_color");
          modules.$cell(source_cell).$attached("cell_connected");
          modules.$cell(target_cell).$attached("cell_connected");
          return $send(self, 'wait', [0.6], function $$7(){
            
            modules.$cell(source_cell).$attached("cell_color");
            modules.$cell(target_cell).$attached("cell_color");
            modules.$cell(source_cell).$detached("cell_connected");
            return modules.$cell(target_cell).$detached("cell_connected");});
        };}, {$$s: self});}, {$$s: self});
  });
  self.$create_matrix("0_0_0");
  
  $def(self, '$set_title', function $$set_title() {
    var self = this, project_name = nil;

    
    project_name = self.$grab("current_project").$data();
    return self.$grab("title").$data(project_name);
  });
  
  $def(self, '$vivify', function $$vivify(params) {
    var self = this;

    return self.$puts("send to back ==> " + (params))
  });
  
  $def(self, '$load_project', function $$load_project(data) {
    var self = this, project_id = nil, new_project_name = nil;

    
    project_id = data['$[]']("id");
    self.$vivify(project_id);
    new_project_name = data['$[]']("name");
    self.$grab("current_project").$data(new_project_name);
    return self.$set_title();
  });
  
  $def(self, '$fill_toolzone', function $$fill_toolzone(ids) {
    var self = this, svg_color = nil, margin = nil, support_style = nil, icon_spacing = nil;

    
    svg_color = "rgba(180, 120, 50, 1)";
    margin = self.$vie_styles()['$[]']("margin");
    support_style = self.$vie_styles()['$[]']("support_style");
    icon_spacing = $rb_plus(self.$vie_styles()['$[]']("support_style")['$[]']("height"), $rb_times(margin, 2));
    return $send(ids, 'each_with_index', [], function $$8(id_found, index){var self = $$8.$$s == null ? this : $$8.$$s, support = nil;

      
      if (id_found == null) id_found = nil;
      if (index == null) index = nil;
      support = self.$grab("toolbox").$box(support_style.$merge($hash2(["top", "id"], {"top": $rb_plus($rb_times(icon_spacing, index), margin), "id": "tool_support_" + (index)})));
      self.$display_svg(self.$get_icon(id_found), svg_color, support.$id());
      return $send(support, 'touch', [true], function $$9(){var self = $$9.$$s == null ? this : $$9.$$s;

        return self.$send("action_" + (id_found))}, {$$s: self});}, {$$s: self});
  });
  self.$fill_toolzone(["load", "clear", "settings", "edition", "select", "group", "copy", "paste", "undo"]);
  
  $def(self, '$action_clear', function $$action_clear() {
    var self = this;

    return $send(self.$grab("selected").$data(), 'each', [], function $$10(selected_slot){var self = $$10.$$s == null ? this : $$10.$$s;

      
      if (selected_slot == null) selected_slot = nil;
      return $send(self.$grab(selected_slot).$materials(), 'each', [], function $$11(child_found){var self = $$11.$$s == null ? this : $$11.$$s;

        
        if (child_found == null) child_found = nil;
        if ($truthy(self.$grab(child_found))) {
          return self.$grab(child_found).$delete(true)
        } else {
          return nil
        };}, {$$s: self});}, {$$s: self})
  });
  
  $def(self, '$clear_zone', function $$clear_zone(zone) {
    var self = this;

    
    $send(zone.$materials(), 'each', [], function $$12(child_found){var self = $$12.$$s == null ? this : $$12.$$s;

      
      if (child_found == null) child_found = nil;
      if ($truthy(self.$grab(child_found))) {
        return self.$grab(child_found).$delete(true)
      } else {
        return nil
      };}, {$$s: self});
    return zone.$delete("materials");
  });
  
  $def(self, '$remove_active', function $$remove_active(items) {
    var self = this;

    return $send(items, 'each', [], function $$13(id_found, _properties){var self = $$13.$$s == null ? this : $$13.$$s;

      
      if (id_found == null) id_found = nil;
      if (_properties == null) _properties = nil;
      if ($truthy(self.$grab(id_found))) {
        self.$grab(id_found).$detached("active_color")
      };
      if ($truthy(self.$grab(id_found))) {
        return self.$grab(id_found).$attached("inactive_color")
      } else {
        return nil
      };}, {$$s: self})
  });
  
  $def(self, '$list', function $$list(parent, style, items) {
    var self = this, margin = nil;

    
    margin = self.$vie_styles()['$[]']("margin");
    return $send(items, 'each_with_index', [], function $$14($mlhs_tmp1, index){var $a, $b, self = $$14.$$s == null ? this : $$14.$$s, id_found = nil, properties = nil, label = nil, item = nil;

      
      if ($mlhs_tmp1 == null) $mlhs_tmp1 = nil;
      if (index == null) index = nil;
      $b = $mlhs_tmp1, $a = $to_ary($b), (id_found = ($a[0] == null ? nil : $a[0])), (properties = ($a[1] == null ? nil : $a[1])), $b;
      label = properties['$[]']("name");
      item = parent.$text($hash2(["data", "id"], {"data": label, "id": id_found}).$merge(style));
      item.$top($rb_plus($rb_times(25, index), margin));
      return $send(item, 'touch', [true], function $$15(){var self = $$15.$$s == null ? this : $$15.$$s;

        
        self.$remove_active(items);
        self.$detached("inactive_color");
        item.$attached(["active_color"]);
        return self.$send(properties['$[]']("action"), properties.$merge($hash2(["id"], {"id": id_found})));}, {$$s: self});}, {$$s: self, $$has_top_level_mlhs_arg: true});
  });
  
  $def(self, '$action_load', function $$action_load() {
    var self = this;

    return self.$controller_sender($hash2(["action"], {"action": "get_projects"}))
  });
  
  $def(self, '$rename_project', function $$rename_project() {
    var self = this;

    return self.$controller_sender($hash2(["action"], {"action": "new_project"}))
  });
  
  $def(self, '$delete_project', function $$delete_project() {
    var self = this;

    return self.$alert("delete : " + (self.$grab("current_project").$data()))
  });
  
  $def(self, '$duplicate_project', function $$duplicate_project() {
    var self = this;

    return self.$alert("duplicate : " + (self.$grab("current_project").$data()))
  });
  
  $def(self, '$action_settings', function $$action_settings() {
    var self = this, inspector = nil, text_list_style = nil, project_name = nil;

    
    inspector = self.$grab("inspector");
    self.$clear_zone(inspector);
    text_list_style = self.$vie_styles()['$[]']("list_style").$merge($hash2(["classes"], {"classes": "settings_list"}));
    project_name = self.$grab("current_project").$data();
    return self.$list(inspector, text_list_style, $hash2(["rename", "delete", "duplicate"], {"rename": $hash2(["name", "data", "action"], {"name": "rename : " + (project_name), "data": "item1", "action": "rename_project"}), "delete": $hash2(["name", "data", "action"], {"name": "delete", "data": "item2", "action": "delete_project"}), "duplicate": $hash2(["name", "data", "action"], {"name": "duplicate", "data": "item3", "action": "duplicate_project"})}));
  });
  
  $def(self, '$action_edition', function $$action_edition() {
    var self = this, inspector = nil, svg_color = nil, margin = nil, support_style = nil, icon_spacing = nil, index = nil;

    
    inspector = self.$grab("inspector");
    self.$clear_zone(inspector);
    svg_color = "rgba(180, 120, 50, 1)";
    margin = self.$vie_styles()['$[]']("margin");
    support_style = self.$vie_styles()['$[]']("support_style");
    icon_spacing = $rb_plus(self.$vie_styles()['$[]']("support_style")['$[]']("height"), $rb_times(margin, 2));
    index = 0;
    return $send(self.$tool_list(), 'each_value', [], function $$16(data){var self = $$16.$$s == null ? this : $$16.$$s, icon_found = nil, action_found = nil, id_found = nil, support = nil;

      
      if (data == null) data = nil;
      icon_found = data['$[]']("icon");
      action_found = data['$[]']("action");
      id_found = data['$[]']("id");
      support = self.$grab("inspector").$box(support_style.$merge($hash2(["top", "id"], {"top": $rb_plus($rb_times(icon_spacing, index), margin), "id": "module_support_" + (index)})));
      self.$svg_fetch(icon_found, svg_color, support.$id());
      $send(support, 'touch', [true], function $$17(){var self = $$17.$$s == null ? this : $$17.$$s;

        return self.$send(action_found, id_found)}, {$$s: self});
      support.$drag(true);
      return (index = $rb_plus(index, 1));}, {$$s: self});
  });
  
  $def(self, '$insert_module', function $$insert_module(module_id) {
    var self = this;

    return $send(self.$grab("selected").$data(), 'each', [], function $$18(module_id_found){var self = $$18.$$s == null ? this : $$18.$$s, module_found = nil, tool_found = nil, tool_color = nil;

      
      if (module_id_found == null) module_id_found = nil;
      module_found = self.$grab(module_id_found);
      $send(module_found.$materials(), 'each', [], function $$19(child_found){var self = $$19.$$s == null ? this : $$19.$$s;

        
        if (child_found == null) child_found = nil;
        if ($truthy(self.$grab(child_found))) {
          return self.$grab(child_found).$delete(true)
        } else {
          return nil
        };}, {$$s: self});
      tool_found = self.$tool_list()['$[]'](module_id)['$[]']("icon");
      tool_color = "orange";
      module_found.$box($hash2(["id", "width", "height", "center", "attached"], {"id": "" + (module_found.$id()) + "_svg_support", "width": $rb_divide(module_found.$width(), 2), "height": $rb_divide(module_found.$height(), 2), "center": true, "attached": "invisible_color"}));
      return self.$svg_fetch(tool_found, tool_color, "" + (module_found.$id()) + "_svg_support");}, {$$s: self})
  });
  
  $def(self, '$action_select', function $$action_select() {
    var self = this, inspector = nil;

    
    inspector = self.$grab("inspector");
    return self.$clear_zone(inspector);
  });
  
  $def(self, '$action_group', function $$action_group() {
    var self = this, inspector = nil;

    
    inspector = self.$grab("inspector");
    return self.$clear_zone(inspector);
  });
  
  $def(self, '$action_copy', function $$action_copy() {
    var self = this, inspector = nil;

    
    inspector = self.$grab("inspector");
    return self.$clear_zone(inspector);
  });
  
  $def(self, '$action_paste', function $$action_paste() {
    var self = this, inspector = nil;

    
    inspector = self.$grab("inspector");
    return self.$clear_zone(inspector);
  });
  
  $def(self, '$action_undo', function $$action_undo() {
    var self = this, inspector = nil;

    
    inspector = self.$grab("inspector");
    return self.$clear_zone(inspector);
  });
  
  $def(self, '$action_get_modules_callback', function $$action_get_modules_callback(body) {
    var self = this;

    
    $send(body, 'each', [], function $$20(module_found){var self = $$20.$$s == null ? this : $$20.$$s, content = nil;

      
      if (module_found == null) module_found = nil;
      content = "project is : " + (module_found["name"]) + "\nid:  " + (module_found["id"]) + "}";
      self.$puts(module_found["icon"]);
      return self.$grab("inspector").$text($hash2(["data", "top", "visual"], {"data": content, "top": 60, "visual": $hash2(["size"], {"size": 12})}));}, {$$s: self});
    if (!$eqeq(body.$length(), 0)) {
      return nil
    };
    return self.$grab("inspector").$text($hash2(["data", "top", "visual"], {"data": "no project", "top": 60, "visual": $hash2(["size"], {"size": 12})}));
  });
  
  $def(self, '$action_get_modules', function $$action_get_modules() {
    var self = this;

    return self.$controller_sender($hash2(["action"], {"action": "get_modules"}))
  });
  module_box = self.$box($hash2(["id", "bottom"], {"id": "get_modules", "bottom": 0}));
  return $send(module_box, 'touch', [true], function $$21(){var self = $$21.$$s == null ? this : $$21.$$s;

    return self.$action_get_modules()}, {$$s: self});
});
